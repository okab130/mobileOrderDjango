# モバイルオーダーシステム 動作確認手順

## 前提条件

開発サーバーが起動していること：
```bash
python manage.py runserver
# スマホからアクセスする場合
# python manage.py runserver 0.0.0.0:8000
```

## アクセス方法

### PCから
- `http://127.0.0.1:8000/`

### スマホから（同一LAN）
- 開発PCのIPアドレスを確認（例: 192.168.1.100）
- `mobile_order/settings.py`で`ALLOWED_HOSTS = ['*']`に変更
- `http://192.168.1.100:8000/`にアクセス

### スマホから（ngrok経由）
- ngrokでトンネル作成: `ngrok http 8000`
- ngrokのURLを`ALLOWED_HOSTS`と`CSRF_TRUSTED_ORIGINS`に追加
- ngrokが表示するURLにアクセス

---

## 1. 顧客側機能の動作確認

### 1.1 セッション開始
1. ブラウザで `http://127.0.0.1:8000/order?table=1` にアクセス
2. 「テーブル1へようこそ」画面が表示される
3. 来店人数に「2」を入力
4. 「開始」ボタンをクリック

### 1.2 メニュー表示・注文
1. メニュー一覧が表示される（8商品）
2. 任意の商品（例：ハンバーグステーキ）をクリック
3. モーダルで商品詳細が表示される
4. 数量を選択（1-10）
5. 「注文する」ボタンをクリック
6. 「注文しました」のアラートが表示される

### 1.3 注文履歴確認
1. ナビゲーションバーの「注文履歴」をクリック
2. 先ほど注文した商品が表示される
3. ステータスが「未着手」になっている
4. 合計金額が表示される

### 1.4 追加注文
1. ナビゲーションバーの「メニュー」をクリック
2. 別の商品を注文
3. 注文履歴に追加される

### 1.5 店員呼び出し
1. ナビゲーションバーの「店員呼出」をクリック
2. 理由を選択（例：お水）
3. 「店員を呼び出しました」のアラートが表示される

### 1.6 会計画面
1. ナビゲーションバーの「会計」をクリック
2. 注文明細と合計金額が表示される

## 2. 管理画面機能の動作確認

### 2.1 ログイン
1. ブラウザで `http://127.0.0.1:8000/management/login/` にアクセス
2. ユーザー名: `admin`
3. パスワード: `admin123`
4. 「ログイン」ボタンをクリック

### 2.2 ダッシュボード（注文管理）
1. ダッシュボードが表示される
2. 左側に「注文一覧」が表示される
   - 先ほど顧客側で注文した商品が表示される
   - テーブル、商品名、数量、注文時刻、経過時間、ステータスが確認できる
3. 右側に「店員呼び出し」が表示される
   - 先ほどの呼び出しが表示される
4. ステータスを変更
   - プルダウンで「調理中」を選択
   - ページがリロードされ、ステータスが更新される
5. 店員呼び出しを対応済みに
   - 「対応済」ボタンをクリック
   - 呼び出しが消える

### 2.3 レシート印刷
1. ダッシュボード右側の「レシート印刷」欄
2. セッションIDに「1」を入力（最初のセッション）
3. 「印刷」ボタンをクリック
4. 新しいタブでレシートが表示される
5. ブラウザの印刷機能で印刷可能

### 2.4 メニュー管理（管理者のみ）
1. ナビゲーションバーの「メニュー管理」をクリック
2. 既存商品一覧が表示される
3. 提供可能のチェックボックスをON/OFFできる
4. 「商品追加」ボタンで新商品を追加できる
5. 「削除」ボタンで商品を削除できる

### 2.5 売上管理（管理者のみ）
1. ナビゲーションバーの「売上管理」をクリック
2. 現時点ではデータなし（セッションが完了していないため）
3. 日別売上、時間帯別売上、商品別ランキングのセクションが表示される

### 2.6 ユーザー管理（管理者のみ）
1. ナビゲーションバーの「ユーザー管理」をクリック
2. 既存ユーザー（admin、staff）が表示される
3. 「ユーザー追加」ボタンで新規ユーザーを作成できる
4. 「削除」ボタンでユーザーを削除できる（自分自身は削除不可）

### 2.7 スタッフユーザーでのログイン
1. ログアウト
2. ユーザー名: `staff` / パスワード: `staff123` でログイン
3. ダッシュボードのみアクセス可能
4. メニュー管理、売上管理、ユーザー管理のメニューが表示されない

## 3. 完全フローテスト

### 3.1 顧客側
1. テーブル2で新しいセッション開始 (`http://127.0.0.1:8000/order?table=2`)
2. 来店人数3人
3. 複数商品を注文（例：カルボナーラ x2、シーザーサラダ x1、アイスコーヒー x3）

### 3.2 管理側
1. 管理画面のダッシュボードで注文を確認
2. 各注文を順次「調理中」→「完成」→「提供済」に変更

### 3.3 会計
1. 顧客画面で会計画面を開く
2. 合計金額を確認
3. 管理画面でセッションID=2のレシートを印刷
4. （実際のPOSレジ連携は不要なため、ここで完了）

## 4. 確認ポイント

✓ 顧客画面はスマホサイズでも表示が崩れない
✓ 注文が即座にダッシュボードに反映される
✓ 複数人が同じテーブルから同時注文できる（ブラウザを複数開いてテスト）
✓ 売り切れ商品はグレーアウト表示される
✓ ステータス変更が正しく動作する
✓ 管理者とスタッフで権限が異なる
✓ 画像が自動リサイズされている（media/menu/ディレクトリ確認）

## トラブルシューティング

### 問題: CSRF検証エラー
- ブラウザのキャッシュをクリアしてリトライ
- シークレットモードで開く

### 問題: 画像が表示されない
- `media/menu/`ディレクトリが存在するか確認
- サーバーログでエラーを確認

### 問題: ダッシュボードが自動リロードされない
- ダッシュボードは30秒ごとに自動リロードされます
- 手動でリロードも可能

## 備考

- このシステムはプロトタイプです
- 本番環境での使用は想定していません
- テストデータは `python manage.py init_data` で再投入できます
- データベースをリセットする場合は `db.sqlite3` を削除してマイグレーション実行
